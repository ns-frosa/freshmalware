from importlib.resources import path
from openpyxl import Workbook
from flask import Flask, redirect, url_for
from flask import send_file
from flask import render_template
import random

app = Flask(__name__)

def createfreshmalware():
    workbook = Workbook()
    sheet = workbook.active

    num = random.randint(1,999999999)

    sheet["A1"] = "This is an automatically generated file, meant to be used in Netskope Demos to show the patient-0 alerting and policy functionality"
    sheet["A2"] = ""
    sheet['A3'] = "Keep in mind this file will only trigger Netskope engines and no other security tool will detect it"
    sheet['A4'] = 'URL: http://itrad3r.com/mine/Panel/PvqDq929BSx_A_D_M1n_a.php'
    sheet['A5'] = ""
    sheet['A6'] = 'The random number below is what makes the file unique and it matches the filename for easy verification'
    sheet['A7'] = num

    fname = "ns_freshmalware_" + str(num) + ".xlsx"
    fullpath = "./samples/" + fname

    workbook.save(filename=fullpath)

    return fname

@app.route('/')
def index():
    return render_template("index.html")

@app.route('/get-known', methods=["GET"])
def download_known():
    file = "static/known.malware"
    return send_file(file, as_attachment=True)

@app.route('/get-unknown', methods=['GET'])
def download_unknown():
    name = createfreshmalware()
    path = "./samples/" + name
    return send_file(path, as_attachment=True)

@app.route('/get')
def redir():
    return redirect(url_for('download_unknown'))




